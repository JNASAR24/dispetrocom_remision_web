<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Remisión</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body{
    font-family: Arial, sans-serif;
    margin:20px;
}
.logo{
    text-align:center;
    margin-bottom:10px;
}
.logo img{
    width:260px;
}
h2{
    text-align:center;
    margin-bottom:10px;
}
table{
    width:100%;
    border-collapse: collapse;
    margin-bottom:6px;
}
td, th{
    border:1px solid black;
    padding:5px;
    font-size:13px;
}
input{
    width:100%;
    border:none;
    outline:none;
    font-size:13px;
}
.header{
    background:#d9ead3;
    font-weight:bold;
    text-align:center;
}
.center{
    text-align:center;
}
.total{
    font-weight:bold;
    text-align:right;
}
.nota{
    font-size:12px;
    padding:10px;
    text-align:center;
}
canvas{
    border:2px solid black;
    touch-action:none;
}
button{
    padding:8px 14px;
    margin-top:10px;
    cursor:pointer;
}
.footer td{
    font-size:11px;
    text-align:center;
    padding:6px;
}
select{
    width:100%;
    border:none;
    font-size:13px;
    background:transparent;
}
</style>
</head>

<body>

<div id="remision">

<div class="logo">
    <img src="Imagenes/logoDispetrocom.png">
</div>
<h2>REMISIÓN <input id="numeroRemision" style="width:90px"></h2>

<table>
<tr>
<td>CLIENTE:</td><td><input></td>
<td>FECHA:</td><td><input type="date"></td>
<td>ORDEN DE COMPRA N°:</td><td><input></td>
</tr>

<tr>
<td>DIRECCIÓN:</td><td><input></td>
<td>OBRA:</td><td><input></td>
<td>CIUDAD:</td><td><input></td>
</tr>

<tr>
<td>PERSONA QUE RECIBE:</td><td><input></td>
<td>CARGO:</td><td><input></td>
<td>N° IDENTIFICACIÓN:</td><td><input></td>
</tr>

<tr>
<td>TELÉFONO PERSONA QUE RECIBE:</td><td><input></td>
<td>HORA DE LLEGADA:</td><td><input type="time"></td>
<td>HORA DE SALIDA:</td><td><input type="time"></td>
</tr>

<tr>
<td>OPERARIO DE VEHÍCULO:</td><td><input></td>
<td>PLACA DEL VEHÍCULO:</td><td><input></td>
<td>CANTIDAD DE SELLOS:</td><td><input></td>
</tr>
</table>


<table>
<tr class="header">
<th>DESCRIPCIÓN DEL EQUIPO</th>
<th>TIPO DE COMBUSTIBLE</th>
<th>CANTIDAD GALONES</th>
</tr>

<!-- Filas -->
<tr>
<td><input></td>
<td>
    <select class="tipo">
        <option value=""></option>
        <option value="BIODIESEL">BIODIESEL</option>
        <option value="GASOLINA CORRIENTE">GASOLINA CORRIENTE</option>
        <option value="GASOLINA EXTRA">GASOLINA EXTRA</option>
    </select>
</td>
<td><input type="number" class="galones" value="0"></td>
</tr>

<tr>
<td><input></td>
<td>
    <select class="tipo">
        <option value=""></option>
        <option value="BIODIESEL">BIODIESEL</option>
        <option value="GASOLINA CORRIENTE">GASOLINA CORRIENTE</option>
        <option value="GASOLINA EXTRA">GASOLINA EXTRA</option>
    </select>
</td>
<td><input type="number" class="galones" value="0"></td>
</tr>

<tr>
<td><input></td>
<td>
    <select class="tipo">
        <option value=""></option>
        <option value="BIODIESEL">BIODIESEL</option>
        <option value="GASOLINA CORRIENTE">GASOLINA CORRIENTE</option>
        <option value="GASOLINA EXTRA">GASOLINA EXTRA</option>
    </select>
</td>
<td><input type="number" class="galones" value="0"></td>
</tr>

<!-- Totales -->
<tr>
<td colspan="2" class="total">BIODIESEL TOTAL GALONES:</td>
<td><input id="totalBiodiesel" readonly></td>
</tr>

<tr>
<td colspan="2" class="total">GASOLINA CORRIENTE TOTAL GALONES:</td>
<td><input id="totalCorriente" readonly></td>
</tr>

<tr>
<td colspan="2" class="total">GASOLINA EXTRA TOTAL GALONES:</td>
<td><input id="totalExtra" readonly></td>
</tr>

<tr>
<td colspan="2" class="total">GRAN TOTAL GALONES:</td>
<td><input id="granTotal" readonly></td>
</tr>
</table>

<table>
<tr class="header">
<td colspan="4">PROCEDIMIENTO DE SATISFACCIÓN DE ENTREGA DE BIOCOMBUSTIBLES (CANTIDAD Y CALIDAD)</td>
</tr>
<tr>
<td colspan="4" class="center">(Espacio para ser diligenciado única y exclusivamente por el cliente)</td>
</tr>
<tr>
<td colspan="4" class="center">SI SU RESPUESTA ES NO; N/A JUSTIFIQUE EN EL CAMPO DE OBSERVACIONES</td>
</tr>
<tr class="header">
<td>ENCUESTA DE CALIDAD Y CANTIDAD</td>
<td>SI</td>
<td>NO</td>
<td>N/A</td>
</tr>

<tr>
<td>1. ¿Se realizó la medida inicial del producto?</td>
<td><input type="checkbox"></td>
<td><input type="checkbox"></td>
<td><input type="checkbox"></td>
</tr>

<tr>
<td>2. ¿Se realizó la prueba de calidad?</td>
<td><input type="checkbox"></td>
<td><input type="checkbox"></td>
<td><input type="checkbox"></td>
</tr>

<tr>
<td>3. ¿Se realizó la prueba de agua?</td>
<td><input type="checkbox"></td>
<td><input type="checkbox"></td>
<td><input type="checkbox"></td>
</tr>

<tr>
<td>4. ¿La muestra presentaba brillantes y transparencia?</td>
<td><input type="checkbox"></td>
<td><input type="checkbox"></td>
<td><input type="checkbox"></td>
</tr>

<tr>
<td>5. ¿El conductor llevó guía de transporte?</td>
<td><input type="checkbox"></td>
<td><input type="checkbox"></td>
<td><input type="checkbox"></td>
</tr>

<tr>
<td>6. ¿Los sellos se encuentran en perfecto estado?</td>
<td><input type="checkbox"></td>
<td><input type="checkbox"></td>
<td><input type="checkbox"></td>
</tr>

<tr>
<td>7. ¿La cantidad solicitada se ajusta al requerimiento?</td>
<td><input type="checkbox"></td>
<td><input type="checkbox"></td>
<td><input type="checkbox"></td>
</tr>
</table>

<table>
<tr><td class="header">OBSERVACIONES</td></tr>
<tr><td><input style="height:50px"></td></tr>
</table>

<table>
<tr>
<td>NOMBRE:</td><td><input></td>
<td>CÉDULA:</td><td><input></td>
</tr>
</table>

<table>
<tr>
<td class="nota">
Nota: Señor cliente tenga en cuenta que la aplicación de este procedimiento es de estricto cumplimiento para todas las entregas, luego, firmado el presente documento, Dispetrocom no se hace responsable por alteraciones presentadas posteriormente en la calidad de los productos entregados y/o diferencias en los inventarios del cliente.
</td>
</tr>
</table>


<h3>FIRMA Y SELLO AUTORIZADO</h3>
<canvas id="firma" width="400" height="150"></canvas>

</div>

<button onclick="limpiar()">Limpiar Firma</button>
<button onclick="exportarPDF()">Exportar PDF</button>

<script>
const galones = document.querySelectorAll(".galones");
const tipos = document.querySelectorAll(".tipo");

const totalBiodiesel = document.getElementById("totalBiodiesel");
const totalCorriente = document.getElementById("totalCorriente");
const totalExtra = document.getElementById("totalExtra");
const granTotal = document.getElementById("granTotal");

/* ================= CONTADOR REMISION ================= */

const inputRemision = document.getElementById("numeroRemision");

function generarNumeroRemision(){

    let contador = localStorage.getItem("contadorRemision");

    if(!contador){
        contador = 1;
    } else {
        contador = Number(contador) + 1;
    }

    localStorage.setItem("contadorRemision", contador);

    const numeroFormateado = "#" + String(contador).padStart(4, "0");
    inputRemision.value = numeroFormateado;
}

//generarNumeroRemision();

function calcular(){

    let biodiesel = 0;
    let corriente = 0;
    let extra = 0;

    tipos.forEach((select, i) => {

        const tipo = select.value;
        const valor = Number(galones[i].value || 0);

        if(tipo === "BIODIESEL") biodiesel += valor;
        if(tipo === "GASOLINA CORRIENTE") corriente += valor;
        if(tipo === "GASOLINA EXTRA") extra += valor;
    });

    totalBiodiesel.value = biodiesel;
    totalCorriente.value = corriente;
    totalExtra.value = extra;

    granTotal.value = biodiesel + corriente + extra;
}

galones.forEach(g => g.addEventListener("input", calcular));
tipos.forEach(t => t.addEventListener("change", calcular));

calcular();

/* FIRMA */
const canvas = document.getElementById("firma");
const ctx = canvas.getContext("2d");
let dibujando=false;

function pos(e){
    const r=canvas.getBoundingClientRect();
    return {
        x:(e.touches?e.touches[0].clientX:e.clientX)-r.left,
        y:(e.touches?e.touches[0].clientY:e.clientY)-r.top
    };
}

canvas.addEventListener("mousedown",e=>{
    dibujando=true;
    const p=pos(e);
    ctx.beginPath();
    ctx.moveTo(p.x,p.y);
});
canvas.addEventListener("mousemove",e=>{
    if(!dibujando)return;
    const p=pos(e);
    ctx.lineTo(p.x,p.y);
    ctx.stroke();
});
canvas.addEventListener("mouseup",()=>dibujando=false);

canvas.addEventListener("touchstart",e=>{
    dibujando=true;
    const p=pos(e);
    ctx.beginPath();
    ctx.moveTo(p.x,p.y);
});
canvas.addEventListener("touchmove",e=>{
    e.preventDefault();
    if(!dibujando)return;
    const p=pos(e);
    ctx.lineTo(p.x,p.y);
    ctx.stroke();
});
canvas.addEventListener("touchend",()=>dibujando=false);

function limpiar(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
}

async function exportarPDF(){

    const { jsPDF } = window.jspdf;

    const elemento = document.getElementById("remision");

    const canvasImg = await html2canvas(elemento,{
        scale: 2,
        useCORS: true
    });

    const imgData = canvasImg.toDataURL("image/png");

    const doc = new jsPDF("p","mm","a4");

    const width = 210;
    const height = canvasImg.height * width / canvasImg.width;

    doc.addImage(imgData,"PNG",0,0,width,height);
    doc.save("Remision.pdf");

    generarNumeroRemision();
}
</script>
<p>v1.6.0</p>
</body>
</html>